# Smart Code Agent v2.0 开发计划

## 一、开发周期总览

- **总周期**：12 周（约 3 个月）
- **开始日期**：2026-02-21
- **结束日期**：2026-05-09

---

## 二、阶段划分

| 阶段 | 周期 | 核心目标 | 交付物 |
|------|------|----------|--------|
| **Phase 0** | 第1周 | 项目初始化、环境搭建 | 可运行的基础项目骨架 |
| **Phase 1** | 第2-3周 | Skill 引擎核心 | Skill 注册、执行、编排能力 |
| **Phase 2** | 第4-5周 | 基础原子 Skill | 8类原子 Skill 实现 |
| **Phase 3** | 第6-7周 | 需求分析工作流 | 完整的采集-分析-确认流程 |
| **Phase 4** | 第8-9周 | 知识库与学习 | 本地知识库 + Web 学习 |
| **Phase 5** | 第10周 | 观察者系统 | 数据记录、报告生成 |
| **Phase 6** | 第11周 | MCP 插件封装 | 对接 OpenCode |
| **Phase 7** | 第12周 | 联调测试与优化 | 完整流程测试、优化 |

---

## 三、详细开发任务

### Phase 0：项目初始化（第1周）

#### Week 1: 环境搭建与骨架

| 任务ID | 任务名称 | 描述 | 预估工时 | 依赖 | 交付物 | 状态 |
|--------|----------|------|----------|------|--------|------|
| T0.1 | 初始化项目结构 | 创建目录结构、package.json、tsconfig.json | 2h | - | 项目骨架 | ✅ 完成 |
| T0.2 | 配置开发工具 | ESLint、Prettier、 Jest 配置 | 2h | T0.1 | 配置文件 | ✅ 完成 |
| T0.3 | 基础类型定义 | SkillInput、SkillOutput、BaseSkill 等接口 | 4h | - | types/index.ts | ✅ 完成 |
| T0.4 | 存储模块实现 | 基础文件系统存储 | 4h | - | storage/index.ts | ✅ 完成 |
| T0.5 | 日志模块实现 | 基础日志系统 | 2h | - | utils/logger.ts | ✅ 完成 |
| T0.6 | MCP 插件配置 | plugin.json 定义 | 2h | - | plugin.json | ✅ 完成 |

**阶段交付**：基础项目骨架，TypeScript 编译通过

---

### Phase 1：Skill 引擎核心（第2-3周）

#### Week 2: Skill 注册与执行器

| 任务ID | 任务名称 | 描述 | 预估工时 | 依赖 | 交付物 | 状态 |
|--------|----------|------|----------|------|--------|------|
| T1.1 | Skill 注册器 | Skill 注册、发现、获取 | 4h | T0.3 | skill-engine/registry.ts | ✅ 完成 |
| T1.2 | Skill 执行器 | Skill 统一执行入口、异常捕获 | 4h | T1.1 | skill-engine/executor.ts | ✅ 完成 |
| T1.3 | Skill 验证器 | 输入输出校验 | 2h | T0.3 | skill-engine/validator.ts | ✅ 完成 |
| T1.4 | Skill 基类完善 | BaseSkill 完整实现 | 4h | T0.3 | skills/base.skill.ts | ✅ 完成 |
| T1.5 | Skill 组合器 | 串行、并行执行能力 | 4h | T1.1 | skill-engine/composer.ts | ✅ 完成 |

#### Week 3: 工作流引擎

| 任务ID | 任务名称 | 描述 | 预估工时 | 依赖 | 交付物 | 状态 |
|--------|----------|------|----------|------|--------|------|
| T1.6 | 工作流定义格式 | YAML/JSON 工作流定义 | 2h | - | config/workflows.ts | ✅ 完成 |
| T1.7 | 工作流解析器 | 解析工作流定义 | 4h | T1.5 | skill-engine/parser.ts | ✅ 完成 |
| T1.8 | 工作流执行器 | 按步骤执行工作流 | 6h | T1.7 | skill-engine/executor.ts | ✅ 完成 |
| T1.9 | 工作流状态管理 | 断点恢复、状态持久化 | 4h | T0.4 | skill-engine/state.ts | ✅ 完成 |
| T1.10 | 内置工作流定义 | 完整需求分析工作流 | 4h | T1.8 | skill-engine/workflows/demand.ts | ✅ 完成 |

**阶段交付**：Skill 引擎具备注册、执行、编排能力 ✅ 完成

---

### Phase 2：基础原子 Skill（第4-5周）

#### Week 4: IO 与 Utility 类 Skill

| 任务ID | 任务名称 | 描述 | 预估工时 | 依赖 | 交付物 | 状态 |
|--------|----------|------|----------|------|--------|------|
| T2.1 | read-file.skill | 读取文件 | 2h | T1.4 | skills/atoms/io/read-file.ts | ✅ 完成 |
| T2.2 | write-file.skill | 写入文件 | 2h | T1.4 | skills/atoms/io/write-file.ts | ✅ 完成 |
| T2.3 | list-dir.skill | 列出目录 | 1h | T1.4 | skills/atoms/io/list-dir.ts | ✅ 完成 |
| T2.4 | wait.skill | 等待/暂停 | 1h | T1.4 | skills/atoms/utility/wait.ts | ✅ 完成 |
| T2.5 | retry.skill | 重试机制 | 2h | T1.4 | skills/atoms/utility/retry.ts | ✅ 完成 |
| T2.6 | branch.skill | 条件分支 | 2h | T1.4 | skills/atoms/utility/branch.ts | ✅ 完成 |
| T2.7 | parallel.skill | 并行执行 | 2h | T1.4 | skills/atoms/utility/parallel.ts | ✅ 完成 |

#### Week 5: 核心业务 Skill

| 任务ID | 任务名称 | 描述 | 预估工时 | 依赖 | 交付物 | 状态 |
|--------|----------|------|----------|------|--------|------|
| T2.8 | ask-question.skill | 提问（基于问题库） | 4h | T1.4 | skills/atoms/ask/question.ts | ✅ 完成 |
| T2.9 | ask-clarify.skill | 追问澄清 | 2h | T1.4 | skills/atoms/ask/clarify.ts | ✅ 完成 |
| T2.10 | ask-confirm.skill | 确认（是/否） | 2h | T1.4 | skills/atoms/ask/confirm.ts | ✅ 完成 |
| T2.11 | save-context.skill | 保存上下文 | 2h | T1.4 | skills/atoms/io/save-context.ts | ✅ 完成 |
| T2.12 | format-code.skill | 格式化代码 | 2h | T1.4 | skills/atoms/format/code.ts | ✅ 完成 |
| T2.13 | analyze-demand.skill | 分析需求 | 2h | T1.4 | skills/atoms/analyze/demand.ts | ✅ 完成 |
| T2.14 | generate-code.skill | 生成代码 | 2h | T1.4 | skills/atoms/generate/code.ts | ✅ 完成 |
| T2.15 | generate-test.skill | 生成测试 | 2h | T1.4 | skills/atoms/generate/test.ts | ✅ 完成 |

**阶段交付**：15+ 原子 Skill 可用 ✅ 完成

---

### Phase 3：需求分析工作流（第6-7周）

#### Week 6: 工作流组装

| 任务ID | 任务名称 | 描述 | 预估工时 | 依赖 | 交付物 |
|--------|----------|------|----------|------|--------|
| T3.1 | demand-collect.skill | 需求采集组合 Skill | 4h | T2.8,T2.9,T2.11 | skills/workflows/demand-collect.ts |
| T3.2 | 场景问题库 | 页面/接口/组件/项目问题库 | 4h | - | data/question-lib/ |
| T3.3 | 需求报告模板 | 需求分析报告模板 | 2h | - | data/templates/demand-report.ts |
| T3.4 | demand-analysis.skill | 需求分析组合 Skill | 4h | T2.13,T3.3 | skills/workflows/demand-analysis.ts |
| T3.5 | demand-confirm.skill | 需求确认组合 Skill | 2h | T2.10 | skills/workflows/demand-confirm.ts |

#### Week 7: 端到端流程

| 任务ID | 任务名称 | 描述 | 预估工时 | 依赖 | 交付物 |
|--------|----------|------|----------|------|--------|
| T3.6 | 完整需求分析工作流 | 采集→分析→确认流程定义 | 4h | T3.1,T3.4,T3.5 | skill-engine/workflows/full-demand.ts |
| T3.7 | 工作流测试 | 单元测试 + 集成测试 | 6h | T3.6 | tests/workflows/ |
| T3.8 | 代码生成工作流 | 代码生成+格式化+测试 | 4h | T2.14,T2.15,T2.12 | skill-engine/workflows/code-gen.ts |
| T3.9 | 完整开发流程 | 从需求到代码的完整流程 | 6h | T3.6,T3.8 | skill-engine/workflows/full-dev.ts |

**阶段交付**：完整的需求到代码生成流程

---

### Phase 4：知识库与学习（第8-9周）

#### Week 8: 知识库基础

| 任务ID | 任务名称 | 描述 | 预估工时 | 依赖 | 交付物 |
|--------|----------|------|----------|------|--------|
| T4.1 | 知识库基础架构 | 存储、索引、查询 | 4h | T0.4 | knowledge/base.ts |
| T4.2 | 知识搜索 | 关键词匹配、相似度搜索 | 4h | T4.1 | knowledge/search.ts |
| T4.3 | 知识添加 | 新知识入库、更新 | 2h | T4.1 | knowledge/add.ts |
| T4.4 | 知识管理命令 | 增删改查管理接口 | 2h | T4.2 | knowledge/cli.ts |

#### Week 9: Web 学习能力

| 任务ID | 任务名称 | 描述 | 预估工时 | 依赖 | 交付物 |
|--------|----------|------|----------|------|--------|
| T4.5 | WebSearch Skill | 调用宿主 WebSearch 能力 | 4h | T skills/atoms/search1.4 |/web-search.ts |
| T4.6 | 学习决策器 | 判断是否需要学习 | 2h | T4.2 | knowledge/learner.ts |
| T4.7 | 知识沉淀器 | Web 内容结构化存储 | 2h | T4.3 | knowledge/沉淀.ts |
| T4.8 | smart-analysis.skill | 智能需求分析（带学习） | 4h | T4.5,T4.6,T4.7 | skills/workflows/smart-analysis.ts |
| T4.9 | 学习效果测试 | 验证学习功能 | 4h | T4.8 | tests/learning/ |

**阶段交付**：具备自我学习能力的知识库

---

### Phase 5：观察者系统（第10周）

#### Week 10: 数据记录与报告

| 任务ID | 任务名称 | 描述 | 预估工时 | 依赖 | 交付物 |
|--------|----------|------|----------|------|--------|
| T5.1 | 阶段记录器 | 各阶段数据采集 | 4h | T1.8 | observer/recorder.ts |
| T5.2 | 用户修改记录 | 手动修改记录机制 | 4h | T0.4 | observer/user-modifications.ts |
| T5.3 | 运行摘要生成 | 单次运行摘要 | 2h | T5.1 | observer/summary.ts |
| T5.4 | 报告生成器 | Markdown 报告输出 | 4h | T5.3 | observer/reporter.ts |
| T5.5 | observe-record.skill | 观察者记录 Skill | 2h | T1.4 | skills/atoms/observe/record.ts |
| T5.6 | observe-report.skill | 观察者报告 Skill | 2h | T1.4 | skills/atoms/observe/report.ts |
| T5.7 | 反馈收集机制 | 用户反馈入口 | 2h | T5.2 | observer/feedback.ts |

**阶段交付**：完整的观察者数据记录与报告系统

---

### Phase 6：MCP 插件封装（第11周）

#### Week 11: 插件集成

| 任务ID | 任务名称 | 描述 | 预估工时 | 依赖 | 交付物 |
|--------|----------|------|----------|------|--------|
| T6.1 | MCP 工具定义 | 定义 sca-start、sca-resume 等工具 | 2h | T0.6 | mcp/tools.ts |
| T6.2 | MCP 资源定义 | 定义知识库、运行记录资源 | 2h | T0.6 | mcp/resources.ts |
| T6.3 | 插件主类 | SmartCodeAgent 主类 | 4h | T3.9,T5.4 | plugin.ts |
| T6.4 | MCP 协议实现 | 实现 MCP 协议接口 | 6h | T6.1,T6.2,T6.3 | mcp/server.ts |
| T6.5 | 插件入口 | index.ts 初始化 | 2h | T6.4 | index.ts |
| T6.6 | 文档编写 | 插件使用文档 | 4h | T6.5 | docs/plugin-usage.md |

**阶段交付**：可安装的 MCP 插件

---

### Phase 7：联调测试与优化（第12周）

#### Week 12: 测试与优化

| 任务ID | 任务名称 | 描述 | 预估工时 | 依赖 | 交付物 |
|--------|----------|------|----------|------|--------|
| T7.1 | 端到端测试 | 完整流程测试 | 8h | T6.4 | tests/e2e/ |
| T7.2 | 性能优化 | 执行效率、内存优化 | 4h | T7.1 | - |
| T7.3 | 错误处理完善 | 异常兜底、边界处理 | 4h | T7.1 | - |
| T7.4 | 文档完善 | 完整使用文档、API 文档 | 6h | T6.6 | docs/ |
| T7.5 | 代码规范检查 | ESLint、Prettier 检查 | 2h | T7.1 | - |
| T7.6 | 打包发布 | 构建、发布 npm 包 | 2h | T7.5 | dist/ |

**阶段交付**：可发布的 v1.0 版本

---

## 四、里程碑节点

| 里程碑 | 日期 | 完成条件 | 交付物 |
|--------|------|----------|--------|
| **M0** | 2026-02-28 | Phase 0 完成 | 项目骨架、基础类型、存储 |
| **M1** | 2026-03-13 | Phase 1 完成 | Skill 引擎、工作流执行 |
| **M2** | 2026-03-27 | Phase 2 完成 | 15+ 原子 Skill |
| **M3** | 2026-04-10 | Phase 3 完成 | 需求到代码完整流程 |
| **M4** | 2026-04-24 | Phase 4+5 完成 | 知识库学习、观察者系统 |
| **M5** | 2026-05-01 | Phase 6 完成 | MCP 插件封装 |
| **M6** | 2026-05-09 | Phase 7 完成 | v1.0 发布 |

---

## 五、依赖关系图

```
T0.1 ─┬─→ T0.2 ─→ T0.3 ─┬─→ T1.1 ─→ T1.2 ─→ T1.3 ─→ T1.4 ─┬─→ T1.5 ─→ T1.6 ─→ T1.7 ─→ T1.8 ─→ T1.9 ─→ T1.10
      │                  │                                   │
      │                  │                                   └─→ T2.1 ─┬─→ T2.8 ─┬─→ T3.1
      │                  │                                       │         │         │
      │                  │                                       │         │         └─→ T3.4 ─→ T3.6 ─→ T3.7 ─→ T3.8 ─→ T3.9
      │                  │                                       │         │
      │                  │                                       │         └─→ T2.14 ─┘
      │                  │                                       │
T0.4 ─┤                  └───────────────────────────────────────┼─────────┴──────────────→ T4.1 ─→ T4.2 ─→ T4.3 ─→ T4.4
      │                                                            │                         │
      │                                                            │                         └─→ T4.5 ─→ T4.6 ─→ T4.7 ─→ T4.8 ─→ T4.9
      │                                                            │
T0.5 ─┤                                                            └──────────────────────────────────────→ T5.1 ─→ T5.2 ─→ T5.3 ─→ T5.4 ─→ T5.5 ─→ T5.6 ─→ T5.7
      │
      └─→ T0.6 ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────→ T6.1 ─→ T6.2 ─→ T6.3 ─→ T6.4 ─→ T6.5 ─→ T6.6 ─→ T7.1 ─→ T7.2 ─→ T7.3 ─→ T7.4 ─→ T7.5 ─→ T7.6
```

---

## 六、每周检查点

| 周次 | 日期 | 检查内容 | 负责人 |
|------|------|----------|--------|
| W1 | 02-21 ~ 02-28 | 项目骨架完成，TypeScript 编译通过 | 开发者 |
| W2 | 03-01 ~ 03-06 | Skill 注册器、执行器可用 | 开发者 |
| W3 | 03-07 ~ 03-13 | 工作流引擎完成，可执行简单工作流 | 开发者 |
| W4 | 03-14 ~ 03-20 | IO、Utility 类 Skill 完成 | 开发者 |
| W5 | 03-21 ~ 03-27 | 核心业务 Skill 完成 | 开发者 |
| W6 | 03-28 ~ 04-03 | 需求采集组合 Skill 完成 | 开发者 |
| W7 | 04-04 ~ 04-10 | 需求分析完整流程可用 | 开发者 |
| W8 | 04-11 ~ 04-17 | 知识库基础完成 | 开发者 |
| W9 | 04-18 ~ 04-24 | Web 学习能力完成 | 开发者 |
| W10 | 04-25 ~ 05-01 | 观察者系统完成 | 开发者 |
| W11 | 05-02 ~ 05-08 | MCP 插件封装完成 | 开发者 |
| W12 | 05-09 | 最终测试、发布 | 开发者 |

---

## 七、技术验收标准

| 阶段 | 验收条件 |
|------|----------|
| Phase 0 | 项目可编译、无错误 |
| Phase 1 | 可注册 Skill、执行工作流 |
| Phase 2 | 15+ 原子 Skill 可用 |
| Phase 3 | 完整需求到代码流程跑通 |
| Phase 4 | 知识库搜索、学习功能正常 |
| Phase 5 | 观察者数据记录、报告生成正常 |
| Phase 6 | MCP 插件可安装、对接成功 |
| Phase 7 | 端到端测试通过、可发布 |

---

## 八、风险与缓冲

| 周次 | 预留缓冲 | 用途 |
|------|----------|------|
| W2-W3 | 1天 | Skill 引擎调试 |
| W5-W6 | 1天 | Skill 组合调试 |
| W7-W8 | 2天 | 工作流联调 |
| W10-W11 | 1天 | 插件集成调试 |
| W12 | 2天 | 测试修复、发布准备 |

---

## 九、代码量预估

| 模块 | 预估代码行数 |
|------|-------------|
| Skill 引擎 | 500+ |
| 原子 Skill (15个) | 1200+ |
| 工作流 | 300+ |
| 知识库 | 400+ |
| 观察者 | 400+ |
| MCP 封装 | 300+ |
| 测试 | 800+ |
| **总计** | **3900+** |

---

*文档版本：v1.0*  
*创建日期：2026-02-21*
